---
phase: 04-annotation-engine
plan: 07
type: execute
wave: 6
depends_on: ["04-06"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can select text and create a highlight"
    - "Highlight appears with gray background (untagged)"
    - "User can tag highlight with a module"
    - "Tagged highlight shows module color"
    - "User can delete a highlight"
    - "Sidebar lists all highlights with jump navigation"
    - "Highlights persist across page refresh"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete annotation workflow through user testing.

Purpose: Ensure the annotation engine meets all Phase 4 success criteria through hands-on testing of the full user flow.

Output: Confirmation that annotation functionality works end-to-end.
</objective>

<execution_context>
@/Users/bharadwajkulkarni/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bharadwajkulkarni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-annotation-engine/04-CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify annotation workflow</name>
  <what-built>
Complete annotation system including:
- Text selection with word boundary snapping
- Floating "Highlight" button for creating annotations
- Highlight rendering with colors (gray untagged, module color tagged)
- Popover for viewing/editing/deleting highlights
- Sidebar listing all annotations with jump-to navigation
- Database persistence via Server Actions
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Visit http://localhost:3000/transcripts
3. Open any transcript

**Test 1: Create Highlight**
- Select some text (2-5 words)
- Confirm selection snaps to word boundaries
- Click "Highlight" button that appears
- Verify highlight appears with gray background

**Test 2: Tag with Module**
- Click on the gray highlight
- In popover, click "Tag with Module"
- Select an existing module (or create one inline)
- Verify highlight changes to module's color

**Test 3: Change/Remove Module**
- Click on a tagged highlight
- Click "Change Module" to switch to different module
- Click "Remove" to untag (should return to gray)

**Test 4: Delete Highlight**
- Click on a highlight
- Click "Delete" in popover
- Confirm deletion
- Verify highlight disappears from text and sidebar

**Test 5: Sidebar Navigation**
- Create 3+ highlights at different positions
- Open sidebar (toggle button on right edge)
- Verify all highlights appear listed
- Click a sidebar entry
- Verify transcript scrolls to that highlight

**Test 6: Cross-Paragraph Selection** (if time)
- Select text spanning 2+ paragraphs
- Create highlight
- Verify it works correctly

**Test 7: Persistence**
- Create a few highlights
- Refresh the page
- Verify all highlights reappear correctly

**Expected Outcomes:**
- All tests pass
- Highlights work in virtualized reader (long transcripts)
- No console errors during normal operation
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass.
If issues found, describe them and type "issues: [description]"
  </resume-signal>
</task>

</tasks>

<verification>
Human verification of complete workflow.
</verification>

<success_criteria>
- [ ] All 7 test scenarios pass
- [ ] No blocking bugs found
- [ ] Annotation workflow feels smooth and intuitive
</success_criteria>

<output>
After completion, create `.planning/phases/04-annotation-engine/04-07-SUMMARY.md`
</output>
