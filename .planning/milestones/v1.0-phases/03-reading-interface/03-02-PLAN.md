---
phase: 03-reading-interface
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/app/transcripts/[id]/page.tsx
  - src/app/transcripts/[id]/loading.tsx
  - src/components/transcripts/TranscriptHeader.tsx
  - src/components/transcripts/ParagraphView.tsx
  - src/components/transcripts/TranscriptReader.tsx
autonomous: true

must_haves:
  truths:
    - "User can view a transcript at /transcripts/[id]"
    - "Transcript displays with paragraph structure visible"
    - "Timestamps appear in left margin gutter"
    - "Speaker labels show only when speaker changes"
    - "Typography is optimized for comfortable reading"
  artifacts:
    - path: "src/app/transcripts/[id]/page.tsx"
      provides: "Single transcript page (Server Component)"
      min_lines: 40
    - path: "src/components/transcripts/TranscriptReader.tsx"
      provides: "Main reading interface component"
      min_lines: 60
    - path: "src/components/transcripts/ParagraphView.tsx"
      provides: "Single paragraph with timestamp and speaker"
      min_lines: 40
  key_links:
    - from: "src/app/transcripts/[id]/page.tsx"
      to: "src/lib/supabase/server.ts"
      via: "data fetching"
      pattern: "createClient"
    - from: "src/components/transcripts/TranscriptReader.tsx"
      to: "src/components/transcripts/ParagraphView.tsx"
      via: "paragraph rendering"
      pattern: "ParagraphView"
---

<objective>
Create the basic transcript reading view with clean typography, paragraph structure, timestamps, and speaker labels.

Purpose: Display transcripts in a comfortable reading format (READ-01 partial - no virtualization yet)
Output: Transcript page at /transcripts/[id] with proper paragraph rendering
</objective>

<execution_context>
@/Users/bharadwajkulkarni/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bharadwajkulkarni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-reading-interface/03-CONTEXT.md
@.planning/phases/03-reading-interface/03-RESEARCH.md
@.planning/phases/03-reading-interface/03-01-SUMMARY.md

# Types for reference
@src/lib/types/transcript.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create paragraph view component</name>
  <files>src/components/transcripts/ParagraphView.tsx</files>
  <action>
Create the paragraph component with timestamp gutter and conditional speaker labels.

Design decisions (from 03-CONTEXT.md):
- Paragraph spacing: compact (py-2)
- Timestamps: left margin gutter (keeps text clean)
- Speaker labels: show on change only
- Theme: light only

Implementation notes (from 03-RESEARCH.md):
- Use padding (not margin) for spacing to avoid height calculation issues with future virtualization
- Fixed-width timestamp gutter for consistent alignment

```typescript
import type { TranscriptParagraph } from '@/lib/types/transcript'

interface ParagraphViewProps {
  paragraph: TranscriptParagraph
  showSpeaker: boolean
  searchQuery?: string // For future search highlighting
}

/**
 * Format timestamp for display (e.g., "1:23:45" or "0:05:30")
 */
function formatTimestamp(timestamp: string | null): string | null {
  if (!timestamp) return null
  // Return as-is if it's already formatted, or parse if needed
  return timestamp
}

export function ParagraphView({
  paragraph,
  showSpeaker,
  searchQuery,
}: ParagraphViewProps) {
  const formattedTimestamp = formatTimestamp(paragraph.timestamp)

  return (
    <div
      className="relative py-2 pl-20"
      data-paragraph-id={paragraph.id}
      data-paragraph-position={paragraph.position}
    >
      {/* Timestamp in left gutter */}
      {formattedTimestamp && (
        <span className="absolute left-0 top-2 w-16 text-right text-xs text-gray-400 font-mono select-none">
          {formattedTimestamp}
        </span>
      )}

      {/* Speaker label (conditional) */}
      {showSpeaker && paragraph.speaker && (
        <div className="mb-1 text-sm font-semibold text-gray-700">
          {paragraph.speaker}
        </div>
      )}

      {/* Paragraph text */}
      <p className="text-base leading-relaxed text-gray-900">
        {paragraph.text}
      </p>
    </div>
  )
}

/**
 * Determine if speaker label should be shown for this paragraph
 */
export function shouldShowSpeaker(
  current: TranscriptParagraph,
  previous?: TranscriptParagraph
): boolean {
  if (!current.speaker) return false
  if (!previous) return true // First paragraph
  return current.speaker !== previous.speaker
}
```
  </action>
  <verify>
- File exists with proper TypeScript types
- Timestamp appears in left gutter (fixed width 16/w-16)
- Uses padding instead of margin for spacing
- Data attributes present for future interaction
  </verify>
  <done>ParagraphView renders paragraph with timestamp gutter and conditional speaker</done>
</task>

<task type="auto">
  <name>Task 2: Create transcript header component</name>
  <files>src/components/transcripts/TranscriptHeader.tsx</files>
  <action>
Create a header component showing transcript metadata.

```typescript
import Link from 'next/link'
import type { Transcript } from '@/lib/types/transcript'
import { formatTranscriptDate, formatWordCount } from '@/lib/types/transcript'

interface TranscriptHeaderProps {
  transcript: Transcript
}

export function TranscriptHeader({ transcript }: TranscriptHeaderProps) {
  return (
    <header className="border-b border-gray-100 pb-8 mb-8">
      <Link
        href="/transcripts"
        className="text-sm text-gray-500 hover:text-gray-700 mb-4 inline-block"
      >
        &larr; Back to transcripts
      </Link>

      <h1 className="text-3xl font-bold text-gray-900 mt-2">
        {transcript.title}
      </h1>

      <div className="mt-4 flex flex-wrap items-center gap-4 text-sm text-gray-600">
        <span>{formatTranscriptDate(transcript.date)}</span>

        {transcript.location && (
          <>
            <span className="text-gray-300">|</span>
            <span>{transcript.location}</span>
          </>
        )}

        {transcript.word_count && (
          <>
            <span className="text-gray-300">|</span>
            <span>{formatWordCount(transcript.word_count)}</span>
          </>
        )}

        {transcript.duration_minutes && (
          <>
            <span className="text-gray-300">|</span>
            <span>{Math.floor(transcript.duration_minutes / 60)}h {transcript.duration_minutes % 60}m</span>
          </>
        )}
      </div>

      {transcript.description && (
        <p className="mt-4 text-gray-600 leading-relaxed">
          {transcript.description}
        </p>
      )}

      {transcript.topic_tags && transcript.topic_tags.length > 0 && (
        <div className="mt-4 flex flex-wrap gap-2">
          {transcript.topic_tags.map((tag) => (
            <Link
              key={tag}
              href={`/transcripts?tag=${encodeURIComponent(tag)}`}
              className="rounded-full bg-gray-100 px-3 py-1 text-xs text-gray-700 hover:bg-gray-200"
            >
              {tag}
            </Link>
          ))}
        </div>
      )}
    </header>
  )
}
```
  </action>
  <verify>
- Shows title, date, location, duration, word count
- Topic tags link back to filtered list
- Back link navigates to /transcripts
  </verify>
  <done>TranscriptHeader displays transcript metadata with back navigation</done>
</task>

<task type="auto">
  <name>Task 3: Create transcript reader component</name>
  <files>src/components/transcripts/TranscriptReader.tsx</files>
  <action>
Create the main reading interface component that renders paragraphs.

This is a client component that will later support virtualization and search.
For now, it renders all paragraphs directly (suitable for smaller transcripts).

```typescript
'use client'

import { useMemo } from 'react'
import type { TranscriptWithParagraphs } from '@/lib/types/transcript'
import { TranscriptHeader } from './TranscriptHeader'
import { ParagraphView, shouldShowSpeaker } from './ParagraphView'

interface TranscriptReaderProps {
  transcript: TranscriptWithParagraphs
}

export function TranscriptReader({ transcript }: TranscriptReaderProps) {
  const paragraphs = useMemo(() => {
    // Sort by position to ensure correct order
    return [...transcript.transcript_paragraphs].sort((a, b) => a.position - b.position)
  }, [transcript.transcript_paragraphs])

  return (
    <div className="min-h-screen bg-white">
      <div className="mx-auto max-w-3xl px-4 py-12">
        <TranscriptHeader transcript={transcript} />

        <article className="pb-24">
          {paragraphs.map((paragraph, index) => (
            <ParagraphView
              key={paragraph.id}
              paragraph={paragraph}
              showSpeaker={shouldShowSpeaker(paragraph, paragraphs[index - 1])}
            />
          ))}
        </article>

        {/* Footer with navigation */}
        <footer className="border-t border-gray-100 pt-8 mt-8">
          <div className="flex justify-between items-center">
            <Link href="/transcripts" className="text-sm text-gray-500 hover:text-gray-700">
              &larr; Back to transcripts
            </Link>
            <button
              onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
              className="text-sm text-gray-500 hover:text-gray-700"
            >
              Back to top &uarr;
            </button>
          </div>
        </footer>
      </div>
    </div>
  )
}
```

Add the missing Link import at the top of the file:
```typescript
import Link from 'next/link'
```
  </action>
  <verify>
- Component is a client component ('use client')
- Paragraphs are sorted by position
- shouldShowSpeaker logic is applied to each paragraph
- Footer has back navigation and scroll-to-top
  </verify>
  <done>TranscriptReader renders all paragraphs with header and footer navigation</done>
</task>

<task type="auto">
  <name>Task 4: Create transcript page route</name>
  <files>src/app/transcripts/[id]/page.tsx, src/app/transcripts/[id]/loading.tsx</files>
  <action>
Create the transcript page route as a Server Component.

Design decisions (from 03-CONTEXT.md):
- Loading state: spinner + transcript title

**src/app/transcripts/[id]/page.tsx:**
```typescript
import { notFound } from 'next/navigation'
import { createClient } from '@/lib/supabase/server'
import { TranscriptReader } from '@/components/transcripts/TranscriptReader'
import type { TranscriptWithParagraphs } from '@/lib/types/transcript'

interface TranscriptPageProps {
  params: Promise<{ id: string }>
}

export async function generateMetadata({ params }: TranscriptPageProps) {
  const { id } = await params
  const supabase = await createClient()

  const { data: transcript } = await supabase
    .from('transcripts')
    .select('title')
    .eq('id', id)
    .single()

  if (!transcript) {
    return { title: 'Transcript Not Found' }
  }

  return {
    title: transcript.title,
    description: `McKenna lecture transcript: ${transcript.title}`,
  }
}

export default async function TranscriptPage({ params }: TranscriptPageProps) {
  const { id } = await params
  const supabase = await createClient()

  // Fetch transcript with all paragraphs
  const { data: transcript, error } = await supabase
    .from('transcripts')
    .select(`
      *,
      transcript_paragraphs (
        id,
        position,
        speaker,
        timestamp,
        text,
        content_hash
      )
    `)
    .eq('id', id)
    .single()

  if (error || !transcript) {
    notFound()
  }

  return <TranscriptReader transcript={transcript as TranscriptWithParagraphs} />
}
```

**src/app/transcripts/[id]/loading.tsx:**
```typescript
export default function TranscriptLoading() {
  return (
    <div className="min-h-screen bg-white">
      <div className="mx-auto max-w-3xl px-4 py-12">
        {/* Header skeleton */}
        <div className="border-b border-gray-100 pb-8 mb-8">
          <div className="h-4 w-32 bg-gray-100 rounded animate-pulse" />
          <div className="mt-4 h-9 w-3/4 bg-gray-200 rounded animate-pulse" />
          <div className="mt-4 flex gap-4">
            <div className="h-4 w-24 bg-gray-100 rounded animate-pulse" />
            <div className="h-4 w-24 bg-gray-100 rounded animate-pulse" />
          </div>
        </div>

        {/* Content skeleton */}
        <div className="space-y-4">
          <div className="flex items-center justify-center py-12">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900" />
            <span className="ml-3 text-gray-600">Loading transcript...</span>
          </div>
        </div>
      </div>
    </div>
  )
}
```
  </action>
  <verify>
- Visit /transcripts/[valid-id] shows transcript content
- Visit /transcripts/[invalid-id] shows 404
- Loading state shows spinner
- Metadata (page title) is set from transcript title
  </verify>
  <done>Transcript page fetches and displays transcript with paragraphs</done>
</task>

<task type="checkpoint:human-verify" gate="non-blocking">
  <what-built>Basic transcript reading view with paragraph structure, timestamps, and speaker labels</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Visit http://localhost:3000/transcripts
3. Click on any transcript to open it
4. Verify the reading view shows:
   - Back link to transcripts list
   - Title, date, and metadata
   - Topic tags (clickable)
   - Paragraphs with proper spacing
   - Timestamps in left gutter (where available)
   - Speaker labels only when speaker changes
5. Test with a longer transcript:
   - Scroll through content
   - Note: Performance may be slow for very long transcripts (expected, virtualization added in 03-03)
6. Test 404:
   - Visit /transcripts/invalid-id
   - Should show Next.js 404 page
7. Verify typography:
   - Text should be comfortable to read
   - Max width should limit line length
   - Line height should be relaxed
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found. Note: slow scrolling on long transcripts is expected and will be fixed in 03-03</resume-signal>
</task>

</tasks>

<verification>
1. Navigate from list to transcript and back
2. Verify paragraph structure matches database order
3. Timestamps appear in consistent left gutter
4. Speaker labels only show when speaker changes
5. Typography is readable (max-width, line-height, font-size)
6. Works for both short and long transcripts (performance is non-goal for this plan)
</verification>

<success_criteria>
- [ ] /transcripts/[id] displays transcript with full paragraph content
- [ ] Timestamps appear in left margin gutter
- [ ] Speaker labels show only on speaker change
- [ ] Header shows title, date, location, word count
- [ ] Topic tags link back to filtered transcript list
- [ ] Loading state shows spinner with "Loading transcript..."
- [ ] Invalid transcript ID returns 404
- [ ] npm run build succeeds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-reading-interface/03-02-SUMMARY.md`
</output>
