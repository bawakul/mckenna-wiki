---
phase: 01.1-corpus-data-fixes
plan: 02
subsystem: database
tags: [supabase, data-migration, metadata, dates, topic-tags]

# Dependency graph
requires:
  - phase: 01.1-corpus-data-fixes-01
    provides: Updated parser with date and topic tag extraction
provides:
  - Database populated with dates and topic_tags
  - 37 unique topic tags catalogued
  - Verified data integrity (96% coverage)
affects: [03-reading-interface, future-filtering]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "--force-metadata flag for metadata-only updates to import-corpus.ts"

key-files:
  created: []
  modified:
    - scripts/seed/import-corpus.ts

key-decisions:
  - "Added --force-metadata flag to enable metadata updates without paragraph re-import"
  - "Accept 4 transcripts without dates as source limitation (not extraction failure)"
  - "Accept 4 transcripts without topic tags as source limitation"

patterns-established:
  - "Metadata-only update pattern for corpus maintenance"

# Metrics
duration: 11min
completed: 2026-02-09
---

# Phase 1.1 Plan 02: Database Re-seed and Verification Summary

**Database updated with dates (96%) and topic tags (96%), 37 unique topic tags catalogued, --force-metadata flag added to import script**

## Performance

- **Duration:** 11 min
- **Started:** 2026-02-09T07:06:09Z
- **Completed:** 2026-02-09T07:16:51Z
- **Tasks:** 4
- **Files modified:** 1 (scripts/seed/import-corpus.ts)

## Accomplishments

- Re-scraped full corpus (92 transcripts) with updated parser extracting dates and topic tags
- Updated all 92 database transcript records with new metadata using --force-metadata flag
- Verified date coverage: 88/92 (96%) - exceeds 90% requirement
- Verified topic tag coverage: 88/92 (96%) - exceeds 90% requirement
- Catalogued 37 unique topic tags with frequency counts
- No duplicate transcripts in database

## Task Commits

1. **Task 1-4: Re-seed, verify, test sorting, catalogue tags** - `502b928` (feat)

**Note:** Tasks 2-4 were verification tasks with no additional code changes beyond Task 1.

## Files Created/Modified

- `scripts/seed/import-corpus.ts` - Added --force-metadata flag for metadata-only updates

## Decisions Made

- **Added --force-metadata flag:** The import script compares content_hash (based on title + paragraphs) to detect changes. Since date/topicTags don't affect content_hash, needed a flag to force metadata updates without re-importing paragraphs.
- **Accept missing dates/tags:** 4 transcripts each missing dates and tags are source limitations from organism.earth, not extraction failures.

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Re-ran corpus scrape - previous execution did not persist data**
- **Found during:** Task 1 (Re-seed database)
- **Issue:** Plan 01.1-01 summary claimed corpus was re-scraped with dates/tags, but JSON files still had null values. The scrape output wasn't persisted to the corpus repo.
- **Fix:** Re-ran full scrape with correct output path: `npm run scrape -- --output "/path/to/mckenna-corpus/transcripts"`
- **Files modified:** 92 JSON files in mckenna-corpus/transcripts/
- **Verification:** Verified JSON files now have date and topicTags populated
- **Committed in:** N/A (corpus repo is external)

**2. [Rule 3 - Blocking] Added --force-metadata flag to bypass content_hash check**
- **Found during:** Task 1 (Re-seed database)
- **Issue:** Seed script skipped all transcripts as "unchanged" because content_hash (based on title + paragraphs) hadn't changed, even though date/topicTags were newly populated.
- **Fix:** Added `--force-metadata` CLI flag to update metadata even when content_hash matches, skipping paragraph re-import for efficiency.
- **Files modified:** scripts/seed/import-corpus.ts
- **Verification:** Re-ran seed with flag, all 92 transcripts updated
- **Committed in:** 502b928

---

**Total deviations:** 2 auto-fixed (2 blocking)
**Impact on plan:** Both fixes essential for completing data migration. No scope creep.

## Issues Encountered

- **Previous plan did not persist scrape output:** The 01.1-01 summary was incorrect - the scraper was run but output was written to the wrong directory (CORPUS_REPO_PATH without /transcripts subdirectory). Fixed by re-running scrape with explicit --output flag.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Database has dates and topic tags ready for UI consumption
- Topic tag filtering already works in UI (implemented in Phase 3)
- Date display already works in transcript list (implemented in Phase 3)
- Phase 1.1 complete, ready for Phase 4 (Annotation Engine)

### Coverage Metrics

| Metric | Count | Percentage |
|--------|-------|------------|
| Total transcripts | 92 | 100% |
| With dates | 88 | 96% |
| With topic tags | 88 | 96% |
| Without dates | 4 | 4% |
| Without topic tags | 4 | 4% |

**Transcripts without dates (source limitation):**
- metaphysics-of-psychedelics
- spirituality-and-technology
- what-ive-learned-from-psychedelics
- intentionality-of-meaning

**Transcripts without topic tags (source limitation):**
- man-and-woman-at-the-end-of-history
- history-ends-in-green
- prague-gnosis-2
- taxonomy-of-illusion

### Unique Topic Tags (37 total)

| Tag | Count |
|-----|-------|
| Psychedelics | 81 |
| Accelerating Change | 61 |
| Futurism | 59 |
| Consciousness | 58 |
| Evolution | 58 |
| Metaphysics | 51 |
| Technology | 47 |
| Omega Point | 44 |
| Transhumanism | 41 |
| Ontology | 40 |
| Epistemology | 37 |
| Meaning | 35 |
| Global Brain | 33 |
| Cosmology | 29 |
| Mythology | 27 |
| Cosmic Consciousness | 26 |
| Emergence | 25 |
| Noosphere | 24 |
| Ecology | 22 |
| Numinous | 22 |
| Entropy and Syntropy | 22 |
| Telepathy | 17 |
| Social Science | 16 |
| Superorganism | 15 |
| Memetics | 15 |
| Virtual Reality | 14 |
| Identity | 12 |
| Hominization | 10 |
| Extended Mind | 10 |
| Systems Theory | 10 |
| Information Theory | 10 |
| Eastern Philosophy | 8 |
| Artificial Intelligence | 7 |
| Neuroscience | 5 |
| Autopoiesis | 4 |
| Economics | 4 |
| Astronomy | 1 |

---
*Phase: 01.1-corpus-data-fixes*
*Completed: 2026-02-09*
